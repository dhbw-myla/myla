% !TEX root =  ../../master.tex
\section{Server}

% VORSCHLAG: -Rene

\subsection{\acl{API}}
Der Server soll nach außen eine \acs{API} mit einzelnen Endpunkten bieten.
Jeder dieser \acs{API}-Endpunkte soll dann für die Ausführung einer speziellen Aktion zuständig sein.
Der Client soll dann auf diese zugreifen können.

Dabei soll die Implementierung der Routen am Programmierparadigma \acs{REST} orientiert werden.
Dabei bietet der Server über die \acs{HTTP}-Methoden die \acs{CRUD}-Operationen an, da er vorwiegend zur Datenhaltung dient.
Hinzu kommt selbstverständlich die Geschäftslogik, die das Erstellen, Durchführen und Auswerten der Umfragen ermöglicht.

% PLAGIAT
%Die \acf{API} dient zur Kommunikation zwischen Client und Server, dabei soll dem Client ermöglichen werden auf Ressourcen des Servers zuzugreifen.
%Dazu müssen zunächst Routen definiert werden, welche nach dem Programmierparadigma \ac{REST} aufgebaut werden.
%Derartige Schnittstellen stellen über die \ac{HTTP}-Methoden die \ac{CRUD}-Operationen zur Verfügung, da in der Regel der Server vorwiegend zur Datenhaltung dient.

% Abschnitt zur vollständigkeit drin. geht mir mehr um das gesamtpaket, dass sowas da is
% In der Anwendung sollen jedoch Datensätze nicht durch den Mitarbeiter verändert werden können, sondern lediglich Änderungen im \ac{ERP}-System eine Änderung der Daten hervorrufen.
% Dies kann über eine Schnittstelle gelöst werden, jedoch müsste dazu das \ac{ERP}-System angepasst werden, sodass Änderungen direkt weitergegeben werden.
% Da eine solche Veränderung jedoch nicht möglich ist, greift die Anwendung direkt auf die Datenbank des \ac{ERP}-Systems zu, um Änderungen festzustellen und in eine eigene Datenbank, wie in Kapitel \ref{chapter:Daten-Transfer} beschrieben, zu übertragen.

% Aus diesem Grund müssen die Routen lediglich lesend zur Verfügung stehen, sodass der Client alle geplanten Funktionen nutzen kann.
% Dabei stellt die \ac{API} grundlegend für jede Berechnung des Servers eine Route zur Verfügung, sodass der Client modular aufgebaut werden kann und eventuelle Einbindungen in bereits bestehende Systeme möglich sind.
%Dennoch ist es dem Nutzer möglich, die Ergebnisse der Berechnung durch eine Sortierung oder Beschränkung, u. a. auf das betrachtete Geschäftsjahr, über in der Anfrage vermerkte Parameter anzupassen.

%Zur Authentifizierung existiert ebenso eine Route, welche den Nutzer überprüft und ein Token ausstellt.
%Das Token muss anschließend bei jeder Anfrage übergeben werden, um die jeweilige Route nutzen zu können.

\subsection{Datenhaltung und Datenmodell}
Um die entsprechenden \acs{API}-Endpunkte mit den zugehörigen Aktionen anbieten zu können, müssen serverseitig Daten gespeichert werden.
Dies umfasst beispielsweise die Umfragen, die zugehörigen Fragen und die darauf gegebenen Antworten.

Hierfür sind relationale Datenbanken weit verbreitet, sodass auch hier, für die im Rahmen dieser Seminararbeit entwickelte Anwendung, eine solche Form der Datenhaltung genutzt wird.
Im Folgenden wird nun das Datenmodell näher vorgestellt.

Da es gemäß der Anforderungen möglich sein soll, Umfragen mehrfach durchzuführen, wird sich entschieden für Umfragen zwei Entitäten einzuführen.
So gibt es zum einen den sogenannten \texttt{SurveyMaster} und zum anderen einen \texttt{Survey}.
Der \texttt{SurveyMaster} entspricht dabei einer Art Vorlage, in der die einzelnen Fragen definiert werden.
Der \texttt{Survey} stellt dann eine konkrete Umfrage dar, die auf genau einem solchen \texttt{SurveyMaster} basiert.
Dadurch ist es möglich mehrere Umfragen mit genau denselben Fragen durchzuführen.

Das entsprechende vereinfachte \acs{ER-Modell} ist in Abbildung~\vref{fig:er-model-simplified} dargestellt.
Zusätzlich befindet sich im Anhang auf Seite~\pageref{fig:er-model} noch Abbildung~\ref{fig:er-model}, die das vollständige \acs{ER-Modell} zeigt.

\begin{figure}[ht]
	\centering
	\def\svgscale{0.72}
	\graphicspath{{img/backend/database/}}
	\scriptsize{\input{img/backend/database/er-myla-simplified-2020-06-04.pdf_tex}}
	\caption{Vereinfachtes \acs{ER-Modell}}
	\label{fig:er-model-simplified}
\end{figure}

Bereits das vereinfachte \acs{ER-Modell} zeigt die Trennung von \texttt{SurveyMaster} und \texttt{Survey} sehr gut.
Die Fragen, die bei jeder solchen Umfrage gleich sein sollen, sind mit dem \texttt{SurveyMaster} verknüpft.
Die Antworten hingegen beziehen sich stets auf die konkrete Umfrage.
Für eine Frage wird ein \acs{JSON} in Textform gespeichert, sodass das Format hier anpassbar ist und vom Front-End festgelegt werden kann.
Bei einer Antwort wird neben der Antwort als solcher noch ein Zeitstempel gespeichert.

Zusätzlich zu den Antworten wird je \texttt{Survey} gezählt, wie viele Teilnahmen es gab.
Dies ermöglicht die Erkennung von Enthaltungen bei Fragen, die nicht verpflichtend beantwortet werden müssen.
Um eine Umfrage für die gewünschten Teilnehmer zugänglich zu machen, zugleich aber sicherzustellen, dass die Umfrage nicht öffentlich verfügbar ist und von jedem beantwortet werden kann, gibt es einen \texttt{survey\_code}.
Hierbei handelt es sich um eine zufällige Zeichenkette, z.~B. \texttt{W3VFG5NHY}, unter der zugegriffen werden kann.
So kann beispielsweise eine Lehrperson nach dem Erstellen einer Umfrage diesen Code mit den Studierenden teilen.

Um einerseits das Thema einer Umfrage für die Teilnehmer erkenntlich zu machen und andererseits auch um Nutzern, die Umfragen erstellen, die Möglichkeit zu geben, Umfragen ordentlich und übersichtlich zu verwalten, haben diese einen Titel.
Dabei gibt es einerseits einen allgemeinen Titel sowie eine Beschreibung auf Ebene des \texttt{SurveyMasters}, z.~B. \enquote{Umfrage Zufriedenheit Vorlesung}.
Zudem ist auf Ebene des \texttt{Surveys} für jede einzelne Umfrage noch ein weiterer Titel gespeichert, um die einzelnen Umfragen auseinanderhalten zu können.
Hier kann beispielsweise das Datum oder der Name des Kurses verwendet werden.

Zudem ist jeder \texttt{SurveyMaster} und somit auch jeder \texttt{Survey} einem angemeldeten Nutzer zugeordnet.
Auf die entsprechenden Details wird im folgenden Abschnitt~\ref{sec:konzept-sicherheit} zum Thema Sicherheit ab Seite~\pageref{sec:authentifizierung} etwas näher eingegangen.
